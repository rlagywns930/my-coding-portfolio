import requests
import pandas as pd
import urllib.parse
import time
import html
from datetime import datetime

CLIENT_ID = 'kNxRdK1NoBr6GRWiyhgH'
CLIENT_SECRET = '5d5Pt93ALu'

# í‚¤ì›Œë“œë³„ ê·¸ë£¹ ë§¤í•‘
keyword_to_group = {
    # ì•„ì´í…œ ê·¸ë£¹
    "ë‚¨ì ê°€ì„ ì½”íŠ¸": "ì•„ì´í…œ",
    "ë‚¨ì ë‹ˆíŠ¸ ê°€ë””ê±´": "ì•„ì´í…œ",
    "ë‚¨ì ì…”ì¸ ": "ì•„ì´í…œ",
    "ë‚¨ì íŠ¸ë™ì…‹ì—…": "ì•„ì´í…œ",
    "ë‚¨ì ìœˆë“œë¸Œë ˆì´ì»¤": "ì•„ì´í…œ",
    "ë‚¨ì ë ˆë” ìì¼“": "ì•„ì´í…œ",
    "ë‚¨ì ë°ë‹˜ ì…‹ì—…": "ì•„ì´í…œ",
    "ë‚¨ì ê°€ì„ ì‹ ë°œ": "ì•„ì´í…œ",
    "ë‚¨ì í—¨ë¦¬ë„¥": "ì•„ì´í…œ",
    "ë‚¨ì ë¸”ë£¨ì¢… ìì¼“": "ì•„ì´í…œ",
    "ë‚¨ì ìŠ¤ì›¨ì´ë“œ ìì¼“": "ì•„ì´í…œ",
    "ë‚¨ì í›„ë“œì§‘ì—…": "ì•„ì´í…œ",
    "ë‚¨ì ì¹´ê³  íŒ¬ì¸  ê°€ì„": "ì•„ì´í…œ",

    # ì•…ì„¸ì‚¬ë¦¬ ê·¸ë£¹
    "ë‚¨ì ê°€ì„ ì•…ì„¸ì‚¬ë¦¬": "ì•…ì„¸ì‚¬ë¦¬",
    "ë‚¨ì ê°€ì„ ì•ˆê²½": "ì•…ì„¸ì‚¬ë¦¬",
    "ë‚¨ì ê°€ì„ ëª¨ì": "ì•…ì„¸ì‚¬ë¦¬",
    "ë‚¨ì ê°€ì„ ì‹œê³„": "ì•…ì„¸ì‚¬ë¦¬",
    "ë‚¨ì ê°€ì„ ê°€ë°©": "ì•…ì„¸ì‚¬ë¦¬",
    "ë‚¨ì ìŠ¤ì¹´í”„ ê°€ì„ ìŠ¤íƒ€ì¼": "ì•…ì„¸ì‚¬ë¦¬",

    # ìŠ¤íƒ€ì¼ ê·¸ë£¹
    "ë‚¨ì ìŠ¤íŠ¸ë¦¿ íŒ¨ì…˜ ê°€ì„": "ìŠ¤íƒ€ì¼",
    "ë‚¨ì ë¯¸ë‹ˆë©€ë£© ê°€ì„": "ìŠ¤íƒ€ì¼",
    "ë‚¨ì ìºì£¼ì–¼ ê°€ì„ ì½”ë””": "ìŠ¤íƒ€ì¼",
    "ë‚¨ì ë ˆíŠ¸ë¡œ íŒ¨ì…˜": "ìŠ¤íƒ€ì¼",
    "ë‚¨ì ë¹„ì¦ˆë‹ˆìŠ¤ ìºì£¼ì–¼": "ìŠ¤íƒ€ì¼",
    "ë‚¨ì ê°€ì„ ë°ì¼ë¦¬ë£©": "ìŠ¤íƒ€ì¼",
    "ë‚¨ì ë£©ë¶ ê°€ì„ ìŠ¤íƒ€ì¼": "ìŠ¤íƒ€ì¼",
    "ê¾¸ì•ˆê¾¸ ë‚¨ì ê°€ì„ ì½”ë””": "ìŠ¤íƒ€ì¼",
    "ëŠì¢‹ë‚¨ ë‚¨ì ê°€ì„ ìŠ¤íƒ€ì¼": "ìŠ¤íƒ€ì¼",
    "ë‚¨ì ê°€ì„ ë‰´íŠ¸ë¡œ íŒ¨ì…˜": "ìŠ¤íƒ€ì¼",  
    "ë‚¨ì ê°€ì„ ì  ë”ë¦¬ìŠ¤ íŒ¨ì…˜": "ìŠ¤íƒ€ì¼",  

    # íŠ¸ë Œë“œ ì»¬ëŸ¬ ê·¸ë£¹
    "ê°€ì„ íŠ¸ë Œë“œ ì»¬ëŸ¬ ëª¨ì¹´ ë¸Œë¼ìš´": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ê°€ì„ íŠ¸ë Œë“œ ì»¬ëŸ¬ ë²„ê±´ë””": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ê°€ì„ íŠ¸ë Œë“œ ì»¬ëŸ¬ ê·¸ë ˆì´": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ê°€ì„ íŠ¸ë Œë“œ ì»¬ëŸ¬ ë² ì´ì§€": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ê°€ì„ íŠ¸ë Œë“œ ì»¬ëŸ¬ ì˜¬ë¦¬ë¸Œ": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ë‚¨ì ë¸Œë¼ìš´ ì½”ë”” ê°€ì„": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ë‚¨ì ë²„ê±´ë”” ë‹ˆíŠ¸ ì½”ë””": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ê°€ì„ ë‚¨ì ì»¬ëŸ¬ ë§¤ì¹˜": "íŠ¸ë Œë“œ ì»¬ëŸ¬",
    "ë¼ì´íŠ¸ ë¸”ë£¨ ì»¬ëŸ¬ ê°€ì„": "íŠ¸ë Œë“œ ì»¬ëŸ¬", 
    "ë‹¤í¬ ê·¸ë¦° ì»¬ëŸ¬ ê°€ì„": "íŠ¸ë Œë“œ ì»¬ëŸ¬",  

    # ë¼ì´í”„ìŠ¤íƒ€ì¼ ê·¸ë£¹
    "ë‚¨ì ì¶œê·¼ë£© ê°€ì„": "ë¼ì´í”„ìŠ¤íƒ€ì¼",
    "ë‚¨ì ë°ì´íŠ¸ ì½”ë”” ê°€ì„": "ë¼ì´í”„ìŠ¤íƒ€ì¼",
    "ë‚¨ì ìº í¼ìŠ¤ë£© ê°€ì„": "ë¼ì´í”„ìŠ¤íƒ€ì¼",
    "ë‚¨ì í•˜ê°ë£© ì½”ë”” ê°€ì„": "ë¼ì´í”„ìŠ¤íƒ€ì¼",
    "ë‚¨ì ì•„ì›ƒë„ì–´ë£© ê°€ì„": "ë¼ì´í”„ìŠ¤íƒ€ì¼" 
}

keywords = list(keyword_to_group.keys())

all_blog_data = []

pages_per_keyword = 21  # ì•½ 210ê°œ ìˆ˜ì§‘ ëª©í‘œ

for keyword in keywords:
    print(f"ğŸ” [í‚¤ì›Œë“œ ì‹œì‘] {keyword}")
    query = f"{keyword} 2025 ë‚¨ì ê°€ì„ íŒ¨ì…˜"
    encoded = urllib.parse.quote(query)

    for start in range(1, pages_per_keyword * 10, 10):
        print(f"  - í˜ì´ì§€ ì‹œì‘ ë²ˆí˜¸: {start}")
        url = f"https://openapi.naver.com/v1/search/blog.json?query={encoded}&display=10&start={start}&sort=date"
        headers = {
            "X-Naver-Client-Id": CLIENT_ID,
            "X-Naver-Client-Secret": CLIENT_SECRET
        }

        res = requests.get(url, headers=headers)
        if res.status_code == 200:
            items = res.json().get("items", [])
            for item in items:
                postdate_str = f"{item['postdate'][:4]}-{item['postdate'][4:6]}-{item['postdate'][6:]}"
                date_obj = datetime.strptime(postdate_str, "%Y-%m-%d")
                all_blog_data.append({
                    "group": keyword_to_group[keyword],
                    "keyword": keyword,
                    "title": html.unescape(item["title"]),
                    "description": html.unescape(item["description"]),
                    "postdate": postdate_str,
                    "year": date_obj.year,
                    "month": date_obj.month
                })
        else:
            print(f"API í˜¸ì¶œ ì‹¤íŒ¨: {res.status_code} / í‚¤ì›Œë“œ: {keyword}")

        time.sleep(1)  # API ì œí•œ íšŒí”¼ ë”œë ˆì´

df = pd.DataFrame(all_blog_data)
df.to_csv("naver_blog_men_fashion_2025_grouped.csv", index=False, encoding='utf-8-sig')

print("ë¸”ë¡œê·¸ ë°ì´í„° ìˆ˜ì§‘ ë° ê·¸ë£¹í™” ì™„ë£Œ!")

